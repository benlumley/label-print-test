<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Label Printer Test</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 540px;
            margin: 40px auto;
            padding: 0 20px;
            color: #1a1a1a;
            background: #f5f5f5;
        }
        h1 { font-size: 1.4rem; margin-bottom: 24px; }
        .field { margin-bottom: 14px; }
        .field label {
            display: block;
            font-size: 0.8rem;
            font-weight: 600;
            color: #555;
            margin-bottom: 4px;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9rem;
            font-family: inherit;
            background: #fff;
        }
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #4a90d9;
            box-shadow: 0 0 0 2px rgba(74, 144, 217, 0.2);
        }
        textarea {
            font-family: "SF Mono", "Fira Code", "Consolas", monospace;
            font-size: 0.8rem;
            line-height: 1.5;
            resize: vertical;
        }
        .row { display: flex; gap: 12px; }
        .row .field { flex: 1; }
        input[type="number"] { max-width: 100%; }
        button {
            background: #2563eb;
            color: #fff;
            border: none;
            border-radius: 6px;
            padding: 10px 24px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 4px;
        }
        button:hover { background: #1d4ed8; }
        button:active { background: #1e40af; }
        button:disabled { background: #93c5fd; cursor: not-allowed; }
        #status {
            margin-top: 12px;
            padding: 10px 12px;
            border-radius: 4px;
            font-size: 0.85rem;
            display: none;
        }
        #status.ok { display: block; background: #dcfce7; color: #166534; border: 1px solid #86efac; }
        #status.err { display: block; background: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; }
        #status.info { display: block; background: #dbeafe; color: #1e40af; border: 1px solid #93c5fd; }
        .format-note {
            font-size: 0.75rem;
            color: #888;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <h1>Label Printer Test</h1>

    <div class="row">
        <div class="field">
            <label for="port">Agent Port</label>
            <input type="number" id="port" value="9100" min="1" max="65535">
        </div>
        <div class="field">
            <label for="format">Format</label>
            <select id="format" onchange="loadTemplate()">
                <option value="zpl">ZPL (Zebra)</option>
                <option value="tpcl">TPCL (Toshiba TEC)</option>
                <option value="epl">EPL2 (Eltron)</option>
                <option value="tspl">TSPL (TSC)</option>
                <option value="escpos">ESC/POS</option>
                <option value="raw">Raw Text</option>
            </select>
        </div>
    </div>

    <div class="field">
        <label for="data">Label Data</label>
        <textarea id="data" rows="14"></textarea>
        <div class="format-note" id="format-note"></div>
    </div>

    <button id="print-btn" onclick="sendPrint()">Send Test Print</button>
    <div id="status"></div>

    <script>
        const templates = {
            zpl: {
                data: `^XA

^FO50,30^A0N,40,40^FDLavandula angustifolia^FS
^FO50,80^A0N,28,28^FDEnglish Lavender^FS
^FO50,130^A0N,20,20^FDPerennial | Full Sun | Zone 5-9^FS
^FO50,170^BQN,2,4^FDQA,https://example.com/plant/123^FS

^XZ`,
                note: "Zebra Programming Language. Widely supported, including Toshiba TEC in ZPL emulation mode."
            },
            tpcl: {
                data: `[ESC]iQ1[LF]
[ESC]iR1[LF]
[ESC]iM02[LF]
[ESC]iS0002[LF]
[ESC]PC000;0050,0030,2,2,C,00,B
Lavandula angustifolia[CR][LF]
[ESC]PC000;0050,0080,2,2,C,00,B
English Lavender[CR][LF]
[ESC]PC000;0050,0130,1,1,C,00,B
Perennial | Full Sun | Zone 5-9[CR][LF]
[ESC]XS;0050,0170,05,03,01
https://example.com/plant/123[CR][LF]
[ESC]Q1[LF]
[ESC]Z[LF]`,
                note: "Toshiba Printer Command Language. Native language for the SA4. Replace [ESC], [LF], [CR] with actual control characters (0x1B, 0x0A, 0x0D)."
            },
            epl: {
                data: `N
q812
Q1218,24
A50,30,0,4,1,1,N,"Lavandula angustifolia"
A50,80,0,3,1,1,N,"English Lavender"
A50,130,0,2,1,1,N,"Perennial | Full Sun | Zone 5-9"
b50,170,Q,s4,"https://example.com/plant/123"
P1`,
                note: "Eltron Programming Language. Used by older Zebra/Eltron printers."
            },
            tspl: {
                data: `SIZE 100 mm, 60 mm
GAP 3 mm, 0
CLS
TEXT 50,30,"4",0,1,1,"Lavandula angustifolia"
TEXT 50,80,"3",0,1,1,"English Lavender"
TEXT 50,130,"2",0,1,1,"Perennial | Full Sun | Zone 5-9"
QRCODE 50,170,L,4,A,0,"https://example.com/plant/123"
PRINT 1`,
                note: "TSC Printer Language. Used by TSC, Printronix, and some compatible printers."
            },
            escpos: {
                data: `[ESC]@
[ESC]a1
[ESC]!0x30
Lavandula angustifolia
[ESC]!0x00

English Lavender

Perennial | Full Sun | Zone 5-9

[GS]k0x31 0x02 0x04
https://example.com/plant/123
[GS]V1`,
                note: "ESC/POS receipt/label format. Mostly for receipt printers but some label printers support it. Replace [ESC], [GS] with 0x1B, 0x1D."
            },
            raw: {
                data: `Lavandula angustifolia
English Lavender
Perennial | Full Sun | Zone 5-9`,
                note: "Plain text. Useful for testing connectivity â€” printer should print the raw text if it accepts it."
            }
        };

        function loadTemplate() {
            const fmt = document.getElementById("format").value;
            const t = templates[fmt];
            document.getElementById("data").value = t.data;
            document.getElementById("format-note").textContent = t.note;
        }

        // Load initial template
        loadTemplate();

        function setStatus(msg, type) {
            const el = document.getElementById("status");
            el.textContent = msg;
            el.className = type;
        }

        async function sendPrint() {
            const btn = document.getElementById("print-btn");
            const port = document.getElementById("port").value;
            const data = document.getElementById("data").value;

            btn.disabled = true;
            btn.textContent = "Sending...";
            setStatus("Sending to localhost:" + port + "...", "info");

            try {
                const resp = await fetch(`http://127.0.0.1:${port}`, {
                    method: "POST",
                    body: data
                });

                if (resp.ok) {
                    setStatus("Sent successfully. Check the printer.", "ok");
                } else {
                    const text = await resp.text();
                    setStatus(`Error ${resp.status}: ${text}`, "err");
                }
            } catch (e) {
                setStatus(
                    `Cannot reach localhost:${port}. Is the print agent running?`,
                    "err"
                );
            } finally {
                btn.disabled = false;
                btn.textContent = "Send Test Print";
            }
        }
    </script>
</body>
</html>
